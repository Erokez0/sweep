# sweep

Настраиваемый сапёр прямо в вашем терминале

![предпросмотр](./assets/sweep-preview.gif)

## Зачем это нужно?

Мне нравится работать в терминале, и я люблю играть в сапёра.

Я хотел найти TUI-версию сапёра, которая была бы одновременно красивой и настраиваемой, но такой не нашёл.
Поэтому я сделал то, что понравилось бы мне самому.

Надеюсь, вам тоже понравится :D

## Требования

Установка [Nerd Font](https://www.nerdfonts.com/) не обязательна, но рекомендуется, чтобы использовать различные символы вместо только [ASCII](#ascii)

## Установка

Чтобы установить [sweep](#sweep), запустите скрипт для вашей системы

### Windows

```powershell
irm https://raw.githubusercontent.com/erokez0/sweep/master/install.ps1 | iex
```

### Linux / MacOS / BSD

```sh
curl -fsSL https://raw.githubusercontent.com/erokez0/sweep/master/install.sh | bash
```

## Как играть

Если вы не знакомы с [сапёром](https://ru.wikipedia.org/wiki/Сапёр_(игра)),
это игра, в которой вы видите поле из клеток, каждая из которых может скрывать мину или быть пустой.
Если в клетке нет мины, в ней отображается количество мин вокруг неё.

Если вы используете [конфигурацию по умолчанию](#файл-конфигурации-по-умолчанию) (а вы используете её, если ещё не меняли), то всё довольно просто:

WASD или <span title="hjkl">клавиши VIM </span> для перемещения курсора

`z` или `enter` чтобы открыть клетку и увидеть её содержимое

> [!NOTE]
> Если вы хотите открыть все не помеченные флагами клетки вокруг курсора,
> просто откройте клетку дважды

`x` или `\` чтобы поставить флаг на клетку

## Конфигурация

В этом разделе рассказывается о настройке вашего игрового процесса

Вся ваша конфигурация хранится так:

```
# Для Windows
C:/Users/user/AppData/Roaming/sweep/
├── config.default.json
├── config.json
└── config.schema.json

# Для UNIX-подобных систем
~/.config/sweep
├── config.default.json
├── config.json
└── config.schema.json
```

### Файл конфигурации

Файл конфигурации для [sweep](#sweep) — это JSON-файл, соответствующий [схеме](#схема-конфигурации), либо оставленный пустым для использования встроенных значений по умолчанию

> [!WARNING]
> Файл конфигурации необходим для работы приложения.

Если файл конфигурации не существует или содержит ошибки, вы получите сообщение об ошибке

#### Параметры

Список всех возможных параметров для настройки

> [!NOTE]
> Поле $schema не обязательно, но полезно, если у вас есть JSON LSP

##### Флаги

Поле `flags` принимает список [флагов](#флаги-1), которые вы, возможно, захотите установить на постоянной основе (например, флаг [fill](#fill)!).
Узнайте больше о [флагах](#флаги-1).

---

##### Цвета

Здесь вы можете задать цвет для каждого типа клетки (0-9, мина, ошибочный флаг, флаг, пустая)

Значение должно быть строкой, содержащей HEX RGB, цвет ANSI или null для цвета по умолчанию.

Некоторые примеры допустимых цветов:

| HEX       | ANSI | цвет       |
| --------- | ---- | ---------- |
| #FF       | 15   | белый      |
| #00       | 0    | чёрный     |
| #FF0000   | 8    | красный    |

> [!NOTE]
> Цвета ANSI предпочтительнее, потому что ваш терминал может изменять их в соответствии с собственной темой.
> Поэтому если вы измените тему, вам не придётся обновлять конфигурацию.
>
> Рекомендую посмотреть [этот сайт](https://hexdocs.pm/color_palette/ansi_color_codes.html), чтобы выбрать цвета ANSI.

Значения по умолчанию такие же, как в [файле конфигурации по умолчанию](#файл-конфигурации-по-умолчанию).

Цвет применяется как цвет переднего плана или как цвет фона, если установлен флаг [fill](#fill).

---

##### Значения по умолчанию

Эти параметры устанавливают значения по умолчанию для соответствующих полей на начальном экране.

- `mines` — количество мин на поле
- `width` — ширина поля в клетках
- `height` — высота поля в клетках

Все они принимают значения типа unsigned 16 bit integer (0-65535) или могут быть оставлены как null, тогда по умолчанию будет использоваться 0.

---

##### Привязки клавиш

Эти параметры задают желаемые клавиши для указанных действий.

- `flag tile` — действие установки флага на клетку под курсором
- `open tile` — действие открытия содержимого клетки под курсором

Эти действия соответствуют перемещению курсора на один шаг в указанном направлении:

- `move cursor down`
- `move cursor up`
- `move cursor right`
- `move cursor left`

##### Движения VIM

- `move cursor to top row` # gg
- `move cursor to bottom row` # G
- `move cursor to first column` # 0
- `move cursor to last column` # $

Количественные модификаторы VIM также поддерживаются. Например:
Если у вас клавиша "j" назначена на перемещение вниз, то "2j" переместит курсор вниз дважды.

Буфер очищается клавишей `escape`.

Значением для каждого параметра является список клавиш или их комбинаций. Это могут быть любые символы с клавиатуры и специальные клавиши, такие как ctrl, backspace, enter, alt, shift и т.д.

---

##### Курсор

Эти параметры предназначены для настройки курсора, чтобы выделение активной клетки выглядело так, как вам хочется.

Параметр `color` такой же, как в [опциях цветов](#цвета).
Значение по умолчанию для `color` — это цвет переднего плана клетки.

Также у нас есть `left half` и `right half`.
Здесь вы можете задать любой символ для левой или правой стороны содержимого клетки (цифры или флага).

###### Несколько примеров

![по умолчанию](./assets/default-config-theme-preview.png)
![цвет 56, <, >](./assets/cursor-56-lt-gt.png)

![цвет 129, (, )](./assets/cursor-129-parentheses.png)
![цвет 69, {, }](./assets/cursor-69-curly-braces.png)

---

##### Постоянные значения по умолчанию

Если вы знаете, какие значения `mines`, `height` и `width` вы хотите использовать постоянно, их можно задать напрямую.

Эти параметры задаются напрямую в [конфигурационном файле](#файл-конфигурации) как ключи.

- mines
- height
- width

Для каждого из них можно задать значение типа unsigned 16 bit integer (0-65535) или null (что странно и используется только для примера в [конфигурации по умолчанию](#файл-конфигурации-по-умолчанию)).

---

##### Символы

Эти параметры позволяют управлять тем, какой символ используется для каждого типа клетки.
Вы можете задать любой один символ в качестве значения для каждого ключа типа клетки.

Например:

По умолчанию клетка `0`, которая сообщает, что вокруг нет мин, использует символ "x". Но вы можете изменить это, установив для ключа "0" в разделе glyphs конфигурации предпочтительный символ.

---

#### Расположение

Расположение конфигурационного файла зависит от вашей операционной системы.

Для Windows это `C:/Users/user/AppData/Roaming/sweep/config.json`

А для UNIX-подобных ОС это `~/.config/sweep/config.json`

---

#### Файл конфигурации по умолчанию

Файл конфигурации по умолчанию служит лишь примером того, как вы можете настроить свой игровой процесс.

> [!NOTE]
> Не следует изменять файл конфигурации по умолчанию.
>
> Он существует только для того, чтобы его скопировать и только затем изменить.

```JSON
{
  "$schema": "./config.schema.json",
  "flags": [
    "--ascii"
  ],
  "colors": {
    "0": "8",
    "1": "12",
    "2": "10",
    "3": "3",
    "4": "9",
    "5": "13",
    "6": "5",
    "7": "1",
    "8": "14",
    "mine": "9",
    "wrong flag": "9",
    "flag": "15",
    "empty": null
  },
  "mines": null,
  "height": null,
  "width": null,
  "defaults": {
    "mines": 0,
    "width": 0,
    "height": 0
  },
  "bindings": {
    "flag tile": [
      "x",
      "\\"
    ],
    "open tile": [
      "z",
      "enter"
    ],
    "move cursor down": [
      "j",
      "s"
    ],
    "move cursor up": [
      "k",
      "w"
    ],
    "move cursor right": [
      "l",
      "d"
    ],
    "move cursor left": [
      "h",
      "a"
    ],
    "move cursor to first column": [
      "0"
    ],
    "move cursor to last column": [
      "$"
    ],
    "move cursor to bottom row": [
      "G",
      "shift+g"
    ],
    "move cursor to top row": [
      "gg"
    ]
  },
  "cursor": {
    "color": null,
    "left half": "[",
    "right half": "]"
  },
  "glyphs": {
    "0": "x",
    "1": "1",
    "2": "2",
    "3": "3",
    "4": "4",
    "5": "5",
    "6": "6",
    "7": "7",
    "8": "8",
    "flag": "󰈻",
    "wrong flag": "󱣮",
    "mine": "󰚑",
    "empty": " "
  }
}
```

Вот как это будет выглядеть, если запустить [предпросмотр темы](#предпросмотр-темы)

```sh
sweep --preview
```
![предпросмотр темы конфигурации по умолчанию](./assets/default-config-theme-preview.png)

Как видите, все возможные поля заполнены. Поля со значением `null` означают, что будут использоваться значения по умолчанию, встроенные в программу.

Привязки клавиш в конфигурации по умолчанию используют клавиши VIM для перемещения, а также WASD, z или enter для открытия клетки и x или \ для установки флага.
Также [движения VIM](#vim-движения) включены по умолчанию.

---

### Схема конфигурации

Схема конфигурации — это JSON-файл, содержащий правила заполнения файла [config.json](#файл-конфигурации).

> [!WARNING]
> Файл конфигурации необходим для работы приложения.

---

### Флаги

Флаги используются для временного изменения существующей конфигурации.

Или, например, для просмотра пути к файлу [`config.json`](#файл-конфигурации) или предпросмотра вашей темы.

> [!NOTE]
> У всех флагов есть короткие и длинные варианты, дающие одинаковый результат.

> [!NOTE]
> Флаги имеют приоритет над [`config.json`](#файл-конфигурации).
>
> Например:
>
> Если указаны `{ "mines": 100 }` и `--mines 125`,
> модуль конфигурации всегда перезапишет конфигурацию из файла в соответствии с предоставленными флагами.

Теперь вы можете увидеть все флаги.

---

#### ASCII

`--A` или `--ascii`

Этот флаг заменяет символы [Nerd Font](https://nerdfonts.com) на текст ASCII.

| Символ         | ASCII |
| -------------- | ----- |
| флаг           | F     |
| мина           | M     |
| ошибочный флаг | W     |

---

#### Путь к файлу конфигурации

`--C` или `--config-path`

Возвращает путь к файлу [`config.json`](#файл-конфигурации).

##### Использование

Вот способ отредактировать [конфигурацию](#файл-конфигурации) с помощью neovim:

```sh
nvim $(sweep --C)
```

Или если вы просто хотите увидеть путь:
```sh
sweep --config-path
```

---

#### Копировать конфигурацию по умолчанию

`--D` или `--default-config`

Копирует [конфигурационный файл по умолчанию](#файл-конфигурации-по-умолчанию) в место расположения [основного конфигурационного файла](#путь-к-файлу-конфигурации).

---

#### Заливка

`--F` или `--fill`

Изменяет то, как [опции цветов](#цвета) влияют на клетки.

Если флаг используется, цвет будет применяться к фону клетки, а цвет переднего плана будет чёрным для тёмного терминала и белым для светлого.
В противном случае цвет будет применяться к переднему плану, а фон будет соответствовать цвету фона терминала.

#### Предпросмотр темы

`--P` или `--preview`

Этот флаг используется для предпросмотра всех типов клеток с их цветами после того, как вы настроили цветовую тему и/или курсор.

##### Использование

<pre>
$ sweep --P --A

<span style="color:grey">x  [x]</span><span style="color:blue">  1  [1]</span>
<span style="color:green">2  [2]</span><span style="color:olive">  3  [3]</span>
<span style="color:red">4  [4]</span><span style="color:purple">  5  [5]</span>
<span style="color:teal">6  [6]</span><span style="color:maroon">  7  [7]</span>
<span style="color:aquamarine">8  [8]</span><span style="color:white">  F  [F]</span>
<span style="color:aquamarine">W  [W]</span><span style="color:white">  M  [M]</span>
</pre>

---

#### Мины

`--M` или `--mines`

Устанавливает количество мин, аналогично [постоянным значениям по умолчанию](#постоянные-значения-по-умолчанию).
Требует аргумент типа unsigned 16 bit integer (0-65535).

##### Использование

```sh
sweep --M 25
```

---

#### Высота

`--H` или `--height`

Устанавливает высоту поля, аналогично [постоянным значениям по умолчанию](#постоянные-значения-по-умолчанию).
Требует аргумент типа unsigned 16 bit integer (0-65535).

##### Использование

```sh
sweep --H 25
```

---

#### Ширина

`--W` или `--width`

Устанавливает ширину поля, аналогично [постоянным значениям по умолчанию](#постоянные-значения-по-умолчанию).
Требует аргумент типа unsigned 16 bit integer (0-65535).

##### Использование

```sh
sweep --W 25
```

---

#### Справка

`--help`

Выводит справочное сообщение, которое в общем-то бесполезно, если вы уже прочитали до сюда.

## Сборка

Этот раздел для тех, кто хочет собрать sweep самостоятельно.

Единственная зависимость для сборки sweep — это [Go](https://go.dev/).
Так что если у вас установлен Go, процесс сборки довольно прост:

```sh
go build
```

## Вклад в проект

Я открыт для предложений, новых идей и сообщений об ошибках.